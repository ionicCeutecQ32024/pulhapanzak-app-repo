"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[68],{4068:(Re,D,b)=>{b.r(D),b.d(D,{ProfilePage:()=>Pe});var c=b(467),a=b(3953),B=b(177),Z=b(3767);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var $=function(i){return i.Unimplemented="UNIMPLEMENTED",i.Unavailable="UNAVAILABLE",i}($||{});class U extends Error{constructor(e,r,t){super(e),this.message=e,this.code=r,this.data=t}}const ne=i=>{var e,r,t,n,o;const l=i.CapacitorCustomPlatform||null,s=i.Capacitor||{},u=s.Plugins=s.Plugins||{},d=i.CapacitorPlatforms,_=(null===(e=null==d?void 0:d.currentPlatform)||void 0===e?void 0:e.getPlatform)||(()=>null!==l?l.name:(i=>{var e,r;return null!=i&&i.androidBridge?"android":null!==(r=null===(e=null==i?void 0:i.webkit)||void 0===e?void 0:e.messageHandlers)&&void 0!==r&&r.bridge?"ios":"web"})(i)),be=(null===(r=null==d?void 0:d.currentPlatform)||void 0===r?void 0:r.isNativePlatform)||(()=>"web"!==_()),ye=(null===(t=null==d?void 0:d.currentPlatform)||void 0===t?void 0:t.isPluginAvailable)||(f=>{const m=G.get(f);return!!(null!=m&&m.platforms.has(_())||z(f))}),z=(null===(n=null==d?void 0:d.currentPlatform)||void 0===n?void 0:n.getPluginHeader)||(f=>{var m;return null===(m=s.PluginHeaders)||void 0===m?void 0:m.find(R=>R.name===f)}),G=new Map,Ce=(null===(o=null==d?void 0:d.currentPlatform)||void 0===o?void 0:o.registerPlugin)||((f,m={})=>{const R=G.get(f);if(R)return console.warn(`Capacitor plugin "${f}" already registered. Cannot register plugins twice.`),R.proxy;const k=_(),x=z(f);let E;const ke=function(){var h=(0,c.A)(function*(){return!E&&k in m?E=E="function"==typeof m[k]?yield m[k]():m[k]:null!==l&&!E&&"web"in m&&(E=E="function"==typeof m.web?yield m.web():m.web),E});return function(){return h.apply(this,arguments)}}(),M=h=>{let g;const P=(...A)=>{const L=ke().then(v=>{const F=((h,g)=>{var P,A;if(!x){if(h)return null===(A=h[g])||void 0===A?void 0:A.bind(h);throw new U(`"${f}" plugin is not implemented on ${k}`,$.Unimplemented)}{const L=null==x?void 0:x.methods.find(v=>g===v.name);if(L)return"promise"===L.rtype?v=>s.nativePromise(f,g.toString(),v):(v,F)=>s.nativeCallback(f,g.toString(),v,F);if(h)return null===(P=h[g])||void 0===P?void 0:P.bind(h)}})(v,h);if(F){const T=F(...A);return g=null==T?void 0:T.remove,T}throw new U(`"${f}.${h}()" is not implemented on ${k}`,$.Unimplemented)});return"addListener"===h&&(L.remove=(0,c.A)(function*(){return g()})),L};return P.toString=()=>`${h.toString()}() { [capacitor code] }`,Object.defineProperty(P,"name",{value:h,writable:!1,configurable:!1}),P},J=M("addListener"),Q=M("removeListener"),Ue=(h,g)=>{const P=J({eventName:h},g),A=function(){var v=(0,c.A)(function*(){const F=yield P;Q({eventName:h,callbackId:F},g)});return function(){return v.apply(this,arguments)}}(),L=new Promise(v=>P.then(()=>v({remove:A})));return L.remove=(0,c.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield A()}),L},H=new Proxy({},{get(h,g){switch(g){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?Ue:J;case"removeListener":return Q;default:return M(g)}}});return u[f]=H,G.set(f,{name:f,proxy:H,platforms:new Set([...Object.keys(m),...x?[k]:[]])}),H});return s.convertFileSrc||(s.convertFileSrc=f=>f),s.getPlatform=_,s.handleError=f=>i.console.error(f),s.isNativePlatform=be,s.isPluginAvailable=ye,s.pluginMethodNoop=(f,m,R)=>Promise.reject(`${R} does not have an implementation of "${m}".`),s.registerPlugin=Ce,s.Exception=U,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s.platform=s.getPlatform(),s.isNative=s.isNativePlatform(),s},I=(i=>i.Capacitor=ne(i))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),W=I.registerPlugin;class q{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,r){var t=this;let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(r);const l=this.windowListeners[e];l&&!l.registered&&this.addWindowListener(l),n&&this.sendRetainedArgumentsForEvent(e);const s=function(){var d=(0,c.A)(function*(){return t.removeListener(e,r)});return function(){return d.apply(this,arguments)}}();return Promise.resolve({remove:s})}removeAllListeners(){var e=this;return(0,c.A)(function*(){e.listeners={};for(const r in e.windowListeners)e.removeWindowListener(e.windowListeners[r]);e.windowListeners={}})()}notifyListeners(e,r,t){const n=this.listeners[e];if(n)n.forEach(o=>o(r));else if(t){let o=this.retainedEventArguments[e];o||(o=[]),o.push(r),this.retainedEventArguments[e]=o}}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:t=>{this.notifyListeners(r,t)}}}unimplemented(e="not implemented"){return new I.Exception(e,$.Unimplemented)}unavailable(e="not available"){return new I.Exception(e,$.Unavailable)}removeListener(e,r){var t=this;return(0,c.A)(function*(){const n=t.listeners[e];if(!n)return;const o=n.indexOf(r);t.listeners[e].splice(o,1),t.listeners[e].length||t.removeWindowListener(t.windowListeners[e])})()}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(t=>{this.notifyListeners(e,t)}))}}const N=i=>encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),V=i=>i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ie extends q{getCookies(){return(0,c.A)(function*(){const e=document.cookie,r={};return e.split(";").forEach(t=>{if(t.length<=0)return;let[n,o]=t.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=V(n).trim(),o=V(o).trim(),r[n]=o}),r})()}setCookie(e){return(0,c.A)(function*(){try{const r=N(e.key),t=N(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,o=(e.path||"/").replace("path=",""),l=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${t||""}${n}; path=${o}; ${l};`}catch(r){return Promise.reject(r)}})()}deleteCookie(e){return(0,c.A)(function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}})()}clearCookies(){return(0,c.A)(function*(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})()}clearAllCookies(){var e=this;return(0,c.A)(function*(){try{yield e.clearCookies()}catch(r){return Promise.reject(r)}})()}}W("CapacitorCookies",{web:()=>new ie});const oe=function(){var i=(0,c.A)(function*(e){return new Promise((r,t)=>{const n=new FileReader;n.onload=()=>{const o=n.result;r(o.indexOf(",")>=0?o.split(",")[1]:o)},n.onerror=o=>t(o),n.readAsDataURL(e)})});return function(r){return i.apply(this,arguments)}}();class ce extends q{request(e){return(0,c.A)(function*(){const r=((i,e={})=>{const r=Object.assign({method:i.method||"GET",headers:i.headers},e),n=((i={})=>{const e=Object.keys(i);return Object.keys(i).map(n=>n.toLocaleLowerCase()).reduce((n,o,l)=>(n[o]=i[e[l]],n),{})})(i.headers)["content-type"]||"";if("string"==typeof i.data)r.body=i.data;else if(n.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[l,s]of Object.entries(i.data||{}))o.set(l,s);r.body=o.toString()}else if(n.includes("multipart/form-data")||i.data instanceof FormData){const o=new FormData;if(i.data instanceof FormData)i.data.forEach((s,u)=>{o.append(u,s)});else for(const s of Object.keys(i.data))o.append(s,i.data[s]);r.body=o;const l=new Headers(r.headers);l.delete("content-type"),r.headers=l}else(n.includes("application/json")||"object"==typeof i.data)&&(r.body=JSON.stringify(i.data));return r})(e,e.webFetchExtra),t=((i,e=!0)=>i?Object.entries(i).reduce((t,n)=>{const[o,l]=n;let s,u;return Array.isArray(l)?(u="",l.forEach(d=>{s=e?encodeURIComponent(d):d,u+=`${o}=${s}&`}),u.slice(0,-1)):(s=e?encodeURIComponent(l):l,u=`${o}=${s}`),`${t}&${u}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=t?`${e.url}?${t}`:e.url,o=yield fetch(n,r),l=o.headers.get("content-type")||"";let u,d,{responseType:s="text"}=o.ok?e:{};switch(l.includes("application/json")&&(s="json"),s){case"arraybuffer":case"blob":d=yield o.blob(),u=yield oe(d);break;case"json":u=yield o.json();break;default:u=yield o.text()}const y={};return o.headers.forEach((_,j)=>{y[j]=_}),{data:u,headers:y,status:o.status,url:o.url}})()}get(e){var r=this;return(0,c.A)(function*(){return r.request(Object.assign(Object.assign({},e),{method:"GET"}))})()}post(e){var r=this;return(0,c.A)(function*(){return r.request(Object.assign(Object.assign({},e),{method:"POST"}))})()}put(e){var r=this;return(0,c.A)(function*(){return r.request(Object.assign(Object.assign({},e),{method:"PUT"}))})()}patch(e){var r=this;return(0,c.A)(function*(){return r.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})()}delete(e){var r=this;return(0,c.A)(function*(){return r.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})()}}W("CapacitorHttp",{web:()=>new ce});var S=function(i){return i.Prompt="PROMPT",i.Camera="CAMERA",i.Photos="PHOTOS",i}(S||{}),O=function(i){return i.Rear="REAR",i.Front="FRONT",i}(O||{}),X=function(i){return i.Uri="uri",i.Base64="base64",i.DataUrl="dataUrl",i}(X||{});class Y extends q{getPhoto(e){var r=this;return(0,c.A)(function*(){return new Promise(function(){var t=(0,c.A)(function*(n,o){if(e.webUseInput||e.source===S.Photos)r.fileInputExperience(e,n,o);else if(e.source===S.Prompt){let l=document.querySelector("pwa-action-sheet");l||(l=document.createElement("pwa-action-sheet"),document.body.appendChild(l)),l.header=e.promptLabelHeader||"Photo",l.cancelable=!1,l.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],l.addEventListener("onSelection",function(){var s=(0,c.A)(function*(u){0===u.detail?r.fileInputExperience(e,n,o):r.cameraExperience(e,n,o)});return function(u){return s.apply(this,arguments)}}())}else r.cameraExperience(e,n,o)});return function(n,o){return t.apply(this,arguments)}}())})()}pickImages(e){var r=this;return(0,c.A)(function*(){return new Promise(function(){var t=(0,c.A)(function*(n,o){r.multipleFileInputExperience(n,o)});return function(n,o){return t.apply(this,arguments)}}())})()}cameraExperience(e,r,t){var n=this;return(0,c.A)(function*(){if(customElements.get("pwa-camera-modal")){const o=document.createElement("pwa-camera-modal");o.facingMode=e.direction===O.Front?"user":"environment",document.body.appendChild(o);try{yield o.componentOnReady(),o.addEventListener("onPhoto",function(){var l=(0,c.A)(function*(s){const u=s.detail;null===u?t(new U("User cancelled photos app")):u instanceof Error?t(u):r(yield n._getCameraPhoto(u,e)),o.dismiss(),document.body.removeChild(o)});return function(s){return l.apply(this,arguments)}}()),o.present()}catch{n.fileInputExperience(e,r,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),n.fileInputExperience(e,r,t)})()}fileInputExperience(e,r,t){let n=document.querySelector("#_capacitor-camera-input");const o=()=>{var l;null===(l=n.parentNode)||void 0===l||l.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",l=>{const s=n.files[0];let u="jpeg";if("image/png"===s.type?u="png":"image/gif"===s.type&&(u="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const d=new FileReader;d.addEventListener("load",()=>{if("dataUrl"===e.resultType)r({dataUrl:d.result,format:u});else if("base64"===e.resultType){const y=d.result.split(",")[1];r({base64String:y,format:u})}o()}),d.readAsDataURL(s)}else r({webPath:URL.createObjectURL(s),format:u}),o()}),n.addEventListener("cancel",l=>{t(new U("User cancelled photos app")),o()})),n.accept="image/*",n.capture=!0,e.source===S.Photos||e.source===S.Prompt?n.removeAttribute("capture"):e.direction===O.Front?n.capture="user":e.direction===O.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e,r){let t=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var o;null===(o=t.parentNode)||void 0===o||o.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",o=>{const l=[];for(let s=0;s<t.files.length;s++){const u=t.files[s];let d="jpeg";"image/png"===u.type?d="png":"image/gif"===u.type&&(d="gif"),l.push({webPath:URL.createObjectURL(u),format:d})}e({photos:l}),n()}),t.addEventListener("cancel",o=>{r(new U("User cancelled photos app")),n()})),t.accept="image/*",t.click()}_getCameraPhoto(e,r){return new Promise((t,n)=>{const o=new FileReader,l=e.type.split("/")[1];"uri"===r.resultType?t({webPath:URL.createObjectURL(e),format:l,saved:!1}):(o.readAsDataURL(e),o.onloadend=()=>{const s=o.result;t("dataUrl"===r.resultType?{dataUrl:s,format:l,saved:!1}:{base64String:s.split(",")[1],format:l,saved:!1})},o.onerror=s=>{n(s)})})}checkPermissions(){var e=this;return(0,c.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw e.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw e.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var e=this;return(0,c.A)(function*(){throw e.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var e=this;return(0,c.A)(function*(){throw e.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var e=this;return(0,c.A)(function*(){throw e.unavailable("Not implemented on web.")})()}}new Y;const ue=W("Camera",{web:()=>new Y});var p=b(4341),w=b(6563),C=b(2107);let fe=(()=>{var i;class e{constructor(){this.storage=(0,a.WQX)(C.wc)}uploadImage(t,n){var o=this;return(0,c.A)(function*(){try{const s=(0,C.KR)(o.storage,`users/${n}.jpg`),u=yield(0,C.qk)(s).catch(()=>null);u&&(yield(0,C.XR)((0,C.KR)(o.storage,u)));const y=yield(yield fetch(t)).blob(),_=yield(0,C.D)(s,y);return yield(0,C.qk)(_.ref)}catch{throw new Error("Error al subir la imagen")}})()}}return(i=e).\u0275fac=function(t){return new(t||i)},i.\u0275prov=a.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function me(i,e){1&i&&(a.j41(0,"ion-note",11),a.EFF(1," El campo es requerido "),a.k0s())}function pe(i,e){1&i&&(a.j41(0,"span"),a.EFF(1,"El campo es requerido"),a.k0s())}function he(i,e){1&i&&(a.j41(0,"span"),a.EFF(1,"El n\xfamero de telefono es inv\xe1lido"),a.k0s())}function ge(i,e){if(1&i&&(a.j41(0,"ion-note",11),a.DNE(1,pe,2,0,"span",12)(2,he,2,0,"span",12),a.k0s()),2&i){const r=a.XpG();a.R7$(),a.Y8G("ngIf",r.isPhoneRequired),a.R7$(),a.Y8G("ngIf",r.isPhoneMinLegthError)}}function ve(i,e){1&i&&a.nrm(0,"ion-spinner",13)}let Pe=(()=>{var i;class e{constructor(){this._authService=(0,a.WQX)(Z.u),this._profielService=(0,a.WQX)(fe),this.formBuilder=(0,a.WQX)(p.ok),this._toasController=(0,a.WQX)(w.K_),this.disabled=!1,this.userForm=this.formBuilder.group({name:["",[p.k0.required]],phone:["",[p.k0.required,p.k0.minLength(8)]],email:["",[p.k0.required,p.k0.email]],photo:["",[p.k0.required]],uid:["",[p.k0.required]],dni:["",[p.k0.required,p.k0.minLength(13),p.k0.maxLength(13),p.k0.pattern("^[0-9]+$")]]}),this.spinner=!1,this.user={}}get isNameRequired(){const t=this.userForm.get("name");return!!t&&t.hasError("required")&&t.touched}get isPhoneRequired(){const t=this.userForm.get("phone");return!!t&&t.hasError("required")&&t.touched}get isPhoneMinLegthError(){const t=this.userForm.get("phone");return!!t&&t.hasError("minlength")&&t.touched}get isFormInvalid(){return this.userForm.invalid}clearSpinner(){this.disabled=!0,this.spinner=!0}setSpinner(){this.disabled=!0,this.spinner=!0}ngOnInit(){var t=this;this._authService.getUserById().then(n=>{this.user=n,this.userForm.patchValue({name:this.user.name,phone:this.user.phone,photo:this.user.photo,email:this.user.email,uid:this.user.uid})}).catch((0,c.A)(function*(){yield t.showAlert("Ha ocurrido un error",!0)}))}onPickImage(){var t=this;return(0,c.A)(function*(){var n,o;const l=yield ue.getPhoto({quality:100,allowEditing:!1,resultType:X.Uri,saveToGallery:!0,promptLabelHeader:"Selecciona una foto",promptLabelPhoto:"Galer\xeda",promptLabelPicture:"C\xe1mara",promptLabelCancel:"Cancelar"});l&&(t.user.photo=null!==(n=null!==(o=l.webPath)&&void 0!==o?o:l.path)&&void 0!==n?n:"",t.userForm.patchValue({photo:t.user.photo}))})()}onSubmit(){var t=this;if(!this.isFormInvalid){this.setSpinner();let n=this.userForm.value;n.email=this.user.email,this._profielService.uploadImage(n.photo,n.uid).then(function(){var o=(0,c.A)(function*(l){n.photo=l,t._authService.updateUser(n).then((0,c.A)(function*(){t.clearSpinner(),yield t.showAlert("Perfil actualizado correctamente")})).catch((0,c.A)(function*(){t.clearSpinner(),yield t.showAlert("Ha ocurrido un error",!0)}))});return function(l){return o.apply(this,arguments)}}()).catch((0,c.A)(function*(){t.clearSpinner(),yield t.showAlert("Ha ocurrido un error",!0)}))}}showAlert(t,n=!1){var o=this;return(0,c.A)(function*(){(yield o._toasController.create({message:t,duration:4e3,color:n?"danger":"success"})).present()})()}}return(i=e).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=a.VBU({type:i,selectors:[["app-profile"]],standalone:!0,features:[a.aNF],decls:21,vars:6,consts:[[1,"ion-padding"],[3,"ngSubmit","formGroup"],[1,"profile-image-container"],["width","30","alt","perfil",1,"image-profile",3,"click","src"],["position","floating"],["type","email","formControlName","name"],["class","form--error-message",4,"ngIf"],["formControlName","dni","type","text"],["type","email","formControlName","phone"],["type","submit","expand","block",1,"ion-margin-top",3,"disabled"],["color","dark",4,"ngIf"],[1,"form--error-message"],[4,"ngIf"],["color","dark"]],template:function(t,n){1&t&&(a.j41(0,"ion-content",0)(1,"form",1),a.bIt("ngSubmit",function(){return n.onSubmit()}),a.j41(2,"div",2)(3,"ion-img",3),a.bIt("click",function(){return n.onPickImage()}),a.k0s()(),a.j41(4,"ion-item")(5,"ion-label",4),a.EFF(6,"Nombres"),a.k0s(),a.nrm(7,"ion-input",5),a.DNE(8,me,2,0,"ion-note",6),a.k0s(),a.j41(9,"ion-item")(10,"ion-label",4),a.EFF(11,"N\xfamero de Identidad"),a.k0s(),a.nrm(12,"ion-input",7),a.k0s(),a.j41(13,"ion-item")(14,"ion-label",4),a.EFF(15,"N\xfamero de Tel\xe9fono"),a.k0s(),a.nrm(16,"ion-input",8),a.DNE(17,ge,3,2,"ion-note",6),a.k0s(),a.j41(18,"ion-button",9),a.DNE(19,ve,1,0,"ion-spinner",10),a.EFF(20," Guardar Perfil "),a.k0s()()()),2&t&&(a.R7$(),a.Y8G("formGroup",n.userForm),a.R7$(2),a.Y8G("src",n.user.photo),a.R7$(5),a.Y8G("ngIf",n.isNameRequired),a.R7$(9),a.Y8G("ngIf",n.isPhoneRequired||n.isPhoneMinLegthError),a.R7$(),a.Y8G("disabled",n.isFormInvalid||n.disabled),a.R7$(),a.Y8G("ngIf",n.spinner))},dependencies:[B.MD,B.bT,w.Jm,w.W9,w.$w,w.KW,w.uz,w.he,w.JI,w.w2,p.X1,p.qT,p.BC,p.cb,p.j4,p.JD],styles:[".profile-image-container[_ngcontent-%COMP%]{width:150px;height:150px;margin:0 auto;overflow:hidden;border-radius:50%}.profile-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}ion-button[_ngcontent-%COMP%]{margin-top:20px}"]}),e})()}}]);